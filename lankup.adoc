= LANKUP User Guide
:Revision:  1.0.0
:Email:     dsx6559@gmail.com
:Date:      2018-04-17
:toc: preamble
:idprefix:
:numbered:
:imagesdir: lankup-images

*LANKUP是一套集备份、恢复、管理、监控为一体的集群备份软件；该手册帮助用户了解如何使用LANKUP系统。*

== 系统逻辑架构
=== 节点类型
- 主控节点:
  * 提供鉴权，任务管理及数据记录等功能
- 客户端:
  * 提供客户端备份/恢复的守护进程
- 存储节点（I）:
  * 提供存储服务，用来指定备份和恢复数据的存储介质
- 登陆节点（L）:
  * 负责所有的登陆操作

=== 网络类型
- 管理网络:
  * 用户通过管理网络直接访问管理节点
- BMC网络:
  * 管理节点通过该网络连接集群中各节点的BMC设备，通过IPMI指令对节点进行开/关机操作、节点状态检测等
- 计算网络：
  * 管理节点通过该网络连接集群中各节点，进行任务管理、存储管理等



== 功能介绍
=== 主控面板

image::main-control-panel.png[]
主控面板提供了整个集群的信息概览，便于快速了解整个集群的工作状态，主控面板默认情况下左右分屏展示分为**主视图区和辅助视图区**，您可以通过机柜视图区提供的快捷菜单切换或隐藏辅助视图区的内容。

=== 主视图区

主视图区主要用于快速查看节点运行状态，您可以以机柜视图或拓扑视图的方式查看各节点信息，方便快捷的完成各种节点相关的操作。


image::main-view-area.png[]
- 机柜视图
在此区域内您可以点选、拖拽、放大机柜信息，可以快速查看各个节点的状态及系统信息，通过主视图区域右侧面板上的快捷按钮可以完成节点登陆、开关机、监控信息查看等操作。系统会根据各个节点的状态以不同颜色的状态灯和背景色绘制机柜图，节点状态一目了然。

=== 拓扑图配置

您可以在拓扑视图中根据您的实际情况配置拓扑视图，具体操作方式:

  * 添加设备：在任意空白处单击鼠标右键，点击**添加设备**菜单，选择设备类型，勾选或者输入设备名称，点击确认完成添加。
  * 连接设备：在任意设备上单机鼠标右键，点击**连接**菜单，移动鼠标选择目标设备即可完成连线，在连线过程中点击任意空白处即可取消连线。
  * 移除设备：在任意设备上单机鼠标右键，点击**移除**菜单即可移除该设备，与该设备连接的所有连线将会一并移除。
  * 编辑连线：在任意设备上单机鼠标右键，点击**编辑**即可编辑该设备上的连线关系。

image::topology.png[]

=== 辅助视图区

辅助视图区默认展示集群信息概览，您可以通过主视图区提供的快捷菜单切换或隐藏辅助视图区的内容。

- 管理员dashboard
以管理员身份查看集群的备份信息，包括：
* 汇总的任务使用信息，便于快速了解集群当前的资源状态。
* 任务备份的使用报表，便于快速了解集群近段时间的工作情况及使用率等信息。

image::managers-dashboard.png[]

=== 节点登陆

选择节点后点击控制面板上的bash按钮可登录到该节点，辅助视图区将用于TTY交互操作：

image::node-details_1.png[]

=== 节点监控信息

选择节点后点击控制面板上的监控图按钮可查看该节点的监控信息，辅助视图区将用于监控信息展示：

image::monitor-center.png[]




== 备份系统
=== 任务列表

image::backup-workspace-tasks_1.png[]
任务列表为您提供系统当前所完成任务的信息概览，您可以通过搜索任务/选择状态快速定位您关心的任务；点击**操作**可以选择重新运行任务和配置参数。

=== 运行任务

image::workspace-run.png[]
选择好任务名称，点击重新运行按钮

image::workspace-run2.png[]
选择备份方式，方式包含差异备份，增量备份，全量备份等等；随后选择好需要备份的客户端，点击提交任务

image::workspace-run3.png[]
image::workspace-run4.png[]
任务完成后可以选择操纵按钮，重新配置参数后，提交任务重新运行

=== 存储管理

image::workspace-storage.png[]
存储管理用来指定备份和恢复数据的存储介质（存储介质可以是本地磁盘，光纤磁盘阵列、磁带和DVD等），主要负责将数据备份到存储介质上。而在数据恢复时，负责将数据从存储介质中传送出去；点击操作按钮包含有：挂载，释放，卸载，状态

=== 客户端管理

image::scheduler-template.png[]
客户端是一个安装在需要备份数据的机器上的守护进程，在备份数据时，它负责把文件传出；在恢复数据时，它负责接收数据并执行恢复操作；
点击操作按钮可方便查看每一台客户端的任务/状态

=== 备份卷管理

image::scheduler-volume.png[]
备份卷是存储数据的具体设备或数据文件；选中对应的备份卷可以进行删除，修改等操作

=== 介质池管理

image::scheduler-pool.png[]
介质池是将卷组合在一起，以便备份不受限于单个卷的大小；点击操作按钮可对介质池进行更新/查看状态操作

=== 恢复向导

image::scheduler-restore_1.png[]
恢复任务，首先第一步选择备份源的客户端

image::scheduler-restore_2.png[]
下一步选择恢复方式和要恢复的备份源是哪个

image::scheduler-restore_3.png[]

image::scheduler-restore_4.png[]

image::scheduler-restore_5.png[]

== 集群管理

=== 节点管理

image::mgmt-node.png[]
- 节点管理列表中列出了当前系统中所有的节点，你可以对任意节点进行下列操作：

* 登录节点
* 查看监控信息
* 查看任务

=== 并行命令

image::mgmt-pcm.png[]
并行命令用于快速批量并行地在指定节点上执行相同命令

=== 进程管理

image::mgmt-process.png[]
进程管理中列出了指定节点的进程信息，您可以在此处管理您服务器上运行的进程。

== 集群监控

=== 监控报警

image::monitor-alarm.png[]
监控报警中记录了集群各节点监控的各种指标的警报信息

image::monitor-alarm-set.png[]
你可以为启用或禁用各个监控指标，也可以为他们设置不同的监控阈值。

image::monitor-alarm-set_2.png[]
您可以启用或禁用报警邮件通知，可以设置多个报警邮件接收人。

=== 服务状态

image::monitor-service.png[]
服务状态列出了当前受到监控的各项服务的运行状态，您可以自由的启用或禁用对某个服务的监控。如果您希望监控更多的服务，可以通过向/usr/hpc/monit目录中加入更多的符合标准的脚本或可执行程序来扩展服务监控。
点击**服务设置**可为各个服务监控脚本配置运行所需的角色信息。

image::monitor-service-setting.png[]

- 脚本规范

image::script.png[]


== 系统配置

=== 配置文件


=== 节点配置

  * 在完成安装后，请以管理员身份登陆系统，点击主界面图例上的设置按钮进入节点配置界面，请根据实际情况完善机柜、节点角色、IPMI等信息。

  * 机柜配置
  * 产品中的机柜为逻辑机柜，机柜中单个节点高度均为1U，绘制高度为10像素，方便您对节点进行组织并展示于主控面板中。机柜配置使用文本格式，请依次填写机柜名、机柜容纳节点的数量、绘图时X坐标、绘图时Y坐标等信息，以逗号分隔，每行为一个机柜。

image::system-node-config_1.png[]
_机架单位是美国电子工业联盟（EIA）用来标定服务器、网络交换机等机房设备的单位。一个机架单位实际上为高度1.75英寸（44毫米），宽度为主流的19英寸（480毫米）及较少用的23英寸（580毫米）。 一个机架单位一般叫做"1U"， 2个机架单位则称之为"2U"，如此类推。_

image::system-node-config_2.png[]
产品部署后会自动收集各个节点的信息，在此基础上，请为各个节点配置下列信息：

  * 角色：用于区分节点角色，默认内置M（管理）、C（计算）、I（I/O）四种角色
  * 机柜：机柜名
  * 机柜位置：机柜插槽位
  * IPMI IP（可选）：用于节点开关机操作
